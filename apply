#!/bin/sh
# yes the shell
# Kacper Wysocki, comotion@krutt.org
# 
# bottom up is better than top down
# 
# git clone repo/gone ; cd gone; ./apply

# let defaults be default: fall back to logic
fqdn=`hostname -f`
host=`hostname`

# substitute installed copies for version controlled ones
cd files/
for file in `find . -type f`
do
	file=`echo $from | sed 's/^files\///'`
	if [ -r "files/$fqdn/$from" ]
	then
		from="files/$fqdn"
	elif [ -r "$from.$host" ]
	then
		from="$from.$host"
	fi
	if diff -bud $from /$file || [ $? = 2 ]
	then
		echo "$from doesn't match local copy, [a]pply, commit or SKIP?"
		# or commit the change
		read choose
		case $choose in
			[aA])
			cp -v $from /$file
			;;

			commit)
			cp -v /$file $from
			git diff $file
			git add $file
			git commit
			;;
			
                        # skip
			*)
		esac
	fi
done
